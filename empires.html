<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Empires Game Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom animations */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Disable text selection for app-like feel */
        body { user-select: none; -webkit-user-select: none; }
        input { user-select: text; -webkit-user-select: text; }

        /* Custom scrollbar hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 font-sans h-screen w-screen overflow-hidden flex flex-col items-center justify-center">

    <!-- App Container -->
    <div id="app" class="w-full max-w-md h-full flex flex-col relative p-6">
        
        <!-- Header -->
        <header class="text-center mb-6 mt-4">
            <h1 class="text-3xl font-bold text-yellow-400 tracking-wider uppercase"><i class="fas fa-crown text-2xl mr-2"></i>Empires</h1>
            <p class="text-slate-400 text-sm mt-1">The Party Game</p>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col justify-center relative w-full">
            
            <!-- Screen 1: Start -->
            <div id="screen-start" class="flex flex-col items-center justify-center space-y-8 fade-in absolute inset-0 bg-slate-900 z-10">
                <div class="text-center space-y-4">
                    <div class="w-24 h-24 bg-yellow-500 rounded-full flex items-center justify-center mx-auto shadow-lg shadow-yellow-500/20 mb-6">
                        <i class="fas fa-play text-slate-900 text-4xl ml-1"></i>
                    </div>
                    <p class="text-lg text-slate-300">Gather your group.<br>Enter your secrets.<br>Let the game begin.</p>
                </div>
                <button onclick="goToScreen('entry')" class="w-full bg-yellow-500 hover:bg-yellow-400 text-slate-900 font-bold py-4 px-8 rounded-xl shadow-lg transition-transform active:scale-95 text-xl">
                    START GAME
                </button>
            </div>

            <!-- Screen 2: Entry -->
            <div id="screen-entry" class="flex flex-col space-y-6 hidden fade-in absolute inset-0 bg-slate-900 z-20">
                <div class="bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-700">
                    <h2 class="text-xl font-semibold mb-4 text-center text-yellow-400">Player <span id="player-count">1</span></h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs uppercase tracking-wide text-slate-500 mb-1 font-bold">Your Name</label>
                            <input type="text" id="input-name" placeholder="e.g. John" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-4 text-lg focus:outline-none focus:border-yellow-500 transition-colors text-white placeholder-slate-600" autocomplete="off">
                        </div>
                        
                        <div>
                            <label class="block text-xs uppercase tracking-wide text-slate-500 mb-1 font-bold">Your Secret (Empire)</label>
                            <input type="text" id="input-secret" placeholder="e.g. I love pineapple pizza" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-4 text-lg focus:outline-none focus:border-yellow-500 transition-colors text-white placeholder-slate-600" autocomplete="off">
                            <p class="text-xs text-slate-500 mt-2 italic text-center">Pass the device securely!</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-3 mt-auto mb-4">
                    <button onclick="nextPlayer()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95 text-lg flex items-center justify-center">
                        <i class="fas fa-user-plus mr-2"></i> Next Player
                    </button>
                    
                    <button onclick="finishEntry()" class="w-full bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-3 rounded-xl transition-transform active:scale-95">
                        Done (Start Playing)
                    </button>
                </div>
            </div>

            <!-- Screen 3: Control -->
            <div id="screen-control" class="flex flex-col items-center justify-center space-y-6 hidden fade-in absolute inset-0 bg-slate-900 z-30">
                <div class="text-center mb-4">
                    <h2 class="text-2xl font-bold text-white mb-2">Game Master</h2>
                    <p class="text-slate-400">Total Players: <span id="final-count" class="text-yellow-400 font-bold">0</span></p>
                </div>

                <!-- Status Display -->
                <div id="reading-status" class="h-32 w-full flex items-center justify-center text-center p-4">
                    <p class="text-slate-500 italic text-lg" id="status-text">Ready to reveal secrets...</p>
                </div>

                <div class="w-full space-y-4 mt-auto mb-8">
                    <button id="btn-read" onclick="readSecrets()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-slate-900 font-bold py-5 rounded-xl shadow-lg transition-transform active:scale-95 text-xl flex items-center justify-center">
                        <i class="fas fa-bullhorn mr-3"></i> Read Secrets Randomly
                    </button>
                    
                    <button onclick="confirmRestart()" class="w-full bg-red-600/20 hover:bg-red-600/30 text-red-400 border border-red-900/50 font-bold py-3 rounded-xl transition-transform active:scale-95 flex items-center justify-center">
                        <i class="fas fa-trash-alt mr-2"></i> Clear & Start Again
                    </button>
                </div>
            </div>

        </main>

        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl border border-slate-700 opacity-0 transition-opacity duration-300 pointer-events-none z-50 flex items-center">
            <i class="fas fa-check-circle text-green-500 mr-2"></i> <span id="toast-msg">Saved</span>
        </div>

        <!-- Confirmation Modal -->
        <div id="modal-confirm" class="fixed inset-0 bg-black/80 hidden items-center justify-center z-50 p-4">
            <div class="bg-slate-800 p-6 rounded-2xl w-full max-w-sm text-center border border-slate-700 shadow-2xl transform scale-100 transition-transform">
                <h3 class="text-xl font-bold text-white mb-2">Start Over?</h3>
                <p class="text-slate-400 mb-6">This will delete all players and secrets.</p>
                <div class="flex space-x-3">
                    <button onclick="closeModal()" class="flex-1 bg-slate-700 text-white py-3 rounded-lg font-bold">Cancel</button>
                    <button onclick="resetGame()" class="flex-1 bg-red-600 text-white py-3 rounded-lg font-bold">Yes, Clear</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- State Management ---
        let players = [];
        let synth = window.speechSynthesis;
        let voices = [];

        // --- Init ---
        window.onload = () => {
            // Load voices
            populateVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = populateVoices;
            }
        };

        function populateVoices() {
            voices = synth.getVoices();
        }

        // --- Navigation Logic ---
        function goToScreen(screenName) {
            // Hide all screens
            ['start', 'entry', 'control'].forEach(id => {
                document.getElementById(`screen-${id}`).classList.add('hidden');
                document.getElementById(`screen-${id}`).classList.remove('flex');
            });

            // Show target screen
            const target = document.getElementById(`screen-${screenName}`);
            target.classList.remove('hidden');
            target.classList.add('flex');

            if (screenName === 'entry') {
                document.getElementById('input-name').focus();
            }
        }

        // --- Game Logic: Entry ---
        function nextPlayer() {
            if (savePlayer()) {
                showToast("Player Saved!");
                clearInputs();
                updatePlayerCountDisplay();
                document.getElementById('input-name').focus();
            }
        }

        function finishEntry() {
            // Save current inputs if they exist, otherwise just move on
            const name = document.getElementById('input-name').value.trim();
            const secret = document.getElementById('input-secret').value.trim();
            
            if (name && secret) {
                savePlayer();
            }
            
            if (players.length === 0) {
                showToast("Need at least 1 player!");
                return;
            }

            document.getElementById('final-count').innerText = players.length;
            goToScreen('control');
        }

        function savePlayer() {
            const nameInput = document.getElementById('input-name');
            const secretInput = document.getElementById('input-secret');
            
            const name = nameInput.value.trim();
            const secret = secretInput.value.trim();

            if (!name || !secret) {
                alert("Please enter both a name and a secret!");
                return false;
            }

            players.push({ name, secret });
            return true;
        }

        function clearInputs() {
            document.getElementById('input-name').value = '';
            document.getElementById('input-secret').value = '';
        }

        function updatePlayerCountDisplay() {
            document.getElementById('player-count').innerText = players.length + 1;
        }

        // --- Game Logic: Reading ---
        function readSecrets() {
            if (synth.speaking) {
                synth.cancel(); // Stop if already talking
                setStatus("Reading stopped.");
                return;
            }

            if (players.length === 0) return;

            // Extract secrets and shuffle them
            const secrets = players.map(p => p.secret);
            const shuffled = shuffleArray([...secrets]);

            setStatus("Reading secrets...");
            
            // Chain utterances
            let delay = 0;
            
            // Initial announcement
            speakText("Attention everyone. Here are the secrets.", 0);
            delay += 2500; // Wait a bit after intro

            shuffled.forEach((secret, index) => {
                setTimeout(() => {
                    setStatus(`Reading Secret #${index + 1}...`);
                    speakText(`Secret number ${index + 1}.`, 0, 1.1); // Slightly faster for numbers
                    
                    // Small pause between number and secret is handled by queue, 
                    // but we add a specific timeout for visual feedback
                    setTimeout(() => {
                        speakText(secret, 500); // 500ms pause after saying secret
                    }, 1500);

                }, delay);
                
                // Estimate duration increment for next loop (rough estimate: 4s per secret)
                delay += 5000; 
            });

            setTimeout(() => {
                setStatus("All secrets revealed.");
                speakText("That is all the secrets. Good luck.", 0);
            }, delay);
        }

        function speakText(text, pauseAfter = 0, rate = 1.0) {
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Try to find a good English voice
            const preferredVoice = voices.find(v => v.name.includes("Google US English")) || 
                                   voices.find(v => v.name.includes("Samantha")) ||
                                   voices.find(v => v.lang.startsWith("en"));
            
            if (preferredVoice) utterance.voice = preferredVoice;
            
            utterance.rate = 0.9 * rate; // Slightly slower for dramatic effect
            utterance.pitch = 1;
            
            synth.speak(utterance);
            
            if (pauseAfter > 0) {
                // Add a silent pause
                // Note: creating an empty utterance sometimes works better for queues than timeouts
                const pause = new SpeechSynthesisUtterance('');
                pause.pause = pauseAfter; 
                // Actual pause logic in WebSpeech is tricky, usually handled by just queueing text.
                // We rely on natural queue.
            }
        }

        // --- Utilities ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function setStatus(msg) {
            document.getElementById('status-text').innerText = msg;
            // Pulse animation
            const statusDiv = document.getElementById('reading-status');
            statusDiv.classList.remove('fade-in');
            void statusDiv.offsetWidth; // trigger reflow
            statusDiv.classList.add('fade-in');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = message;
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.style.opacity = '0';
            }, 2000);
        }

        function confirmRestart() {
            document.getElementById('modal-confirm').classList.remove('hidden');
            document.getElementById('modal-confirm').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('modal-confirm').classList.add('hidden');
            document.getElementById('modal-confirm').classList.remove('flex');
        }

        function resetGame() {
            synth.cancel();
            players = [];
            clearInputs();
            document.getElementById('player-count').innerText = "1";
            setStatus("Ready to reveal secrets...");
            closeModal();
            goToScreen('start');
        }

    </script>
</body>
</html>


